(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();function y(r,n,o){const c=new WebSocket("ws://localhost:3000");return c.addEventListener("open",()=>{n("[Signaling] Connected"),o("signaling","Connected"),c.send(JSON.stringify({type:"join",room:r}))}),c.addEventListener("close",()=>{n("[Signaling] Disconnected"),o("signaling","Disconnected")}),c.addEventListener("error",e=>{n("[Signaling] Error: "+e),o("signaling","Error")}),c}function C(r,n,o){const c={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},e=new RTCPeerConnection(c),t=e.createDataChannel("fileTransfer");return t.onopen=()=>{n("[DataChannel] Open"),o("data","Open")},t.onclose=()=>{n("[DataChannel] Closed"),o("data","Closed")},t.onerror=i=>n("[DataChannel] Error: "+i),e.onicecandidate=i=>{i.candidate&&(r.send(JSON.stringify({type:"candidate",candidate:i.candidate})),n("[WebRTC] Sent ICE candidate"))},e.onconnectionstatechange=()=>{n("[WebRTC] State: "+e.connectionState),o("peer",e.connectionState)},r.addEventListener("message",async i=>{n("[Signaling] Raw message: "+i.data);let d;try{d=JSON.parse(i.data)}catch(a){n("[Signaling] JSON parse error: "+a);return}const{type:s}=d;if(n("[Signaling] Type: "+s),s==="ready")try{const a=await e.createOffer();await e.setLocalDescription(a),r.send(JSON.stringify({type:"offer",offer:a})),n("[WebRTC] Sent offer")}catch(a){n("[WebRTC] Offer error: "+a)}else if(s==="offer"){await e.setRemoteDescription(d.offer);const a=await e.createAnswer();await e.setLocalDescription(a),r.send(JSON.stringify({type:"answer",answer:a})),n("[WebRTC] Sent answer")}else if(s==="answer")await e.setRemoteDescription(d.answer),n("[WebRTC] Received answer");else if(s==="candidate")try{await e.addIceCandidate(d.candidate),n("[WebRTC] Added ICE candidate")}catch(a){n("[WebRTC] ICE error: "+a)}else n("[Signaling] Unknown type: "+s)}),{pc:e,dc:t}}function h(r,n,o){if(!n||n.readyState!=="open"){o("[File] DataChannel not open");return}const c=16*1024;Array.from(r).forEach(e=>{const t=new FileReader;t.onload=()=>{const i=t.result,d=i.byteLength;for(let s=0;s<d;s+=c){const a=Math.min(s+c,d);n.send(i.slice(s,a)),o(`[File] Sent chunk ${s}-${a}`)}o(`[File] Finished sending ${e.name}`)},t.onerror=i=>o("[File] Read error: "+i),t.readAsArrayBuffer(e)})}const S=document.getElementById("joinBtn"),E=document.getElementById("roomInput"),w=document.getElementById("currentRoom"),f=document.getElementById("debug"),p=document.getElementById("fileInput");let g=null,m=null;function u(r){const n=document.createElement("div");n.textContent=r,f.appendChild(n),f.scrollTop=f.scrollHeight,console.log(r)}function l(r,n){const o=document.getElementById(`status-${r}`);o&&(o.querySelector("strong").textContent=n)}S.addEventListener("click",()=>{const r=E.value.trim();if(!r)return alert("Please enter a room ID");f.innerHTML="",w.textContent=r,l("signaling","❌"),l("peer","❌"),l("data","❌"),m=y(r,u,l),g=C(m,u,l).dc});p.addEventListener("change",()=>{h(p.files,g,u)});

(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const d of t.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function a(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=a(e);fetch(e.href,t)}})();const y="wss://relay.drobilica.com:8080",h="__TURN_SERVER_URL__",R="__TURN_USERNAME__",E="__TURN_CREDENTIAL__",w={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:h,username:R,credential:E}]},C=document.getElementById("generateRoomBtn"),f=document.getElementById("roomCode"),L=document.getElementById("copyRoomUrlBtn"),b=document.getElementById("joinRoomInput"),I=document.getElementById("joinRoomBtn"),p=document.getElementById("yourFileInput"),B=document.getElementById("yourFiles"),_=document.getElementById("theirFiles");let i,l;C.addEventListener("click",()=>{const n=Math.random().toString(36).substring(2,10);f.value=n});L.addEventListener("click",()=>{const n=`${window.location.origin}/trade?room=${f.value}`;navigator.clipboard.writeText(n).then(()=>alert("Room URL copied!"))});I.addEventListener("click",()=>{const n=b.value.trim();n&&v(n)});p.addEventListener("change",n=>{Array.from(n.target.files).forEach(a=>g(B,a))});function g(n,o){const a=document.createElement("li");a.textContent=o.name,a.className="border-b py-2";const c=document.createElement("button");c.textContent="Download",c.className="bg-blue-500 text-white px-2 py-1 rounded ml-2",c.addEventListener("click",()=>{const e=URL.createObjectURL(o),t=document.createElement("a");t.href=e,t.download=o.name,t.click()}),a.appendChild(c),n.appendChild(a)}function v(n){const o=new WebSocket(y);o.onopen=()=>{o.send(JSON.stringify({type:"join",room:n}))},o.onmessage=r=>{const s=JSON.parse(r.data);switch(s.type){case"offer":a(s.offer);break;case"answer":c(s.answer);break;case"candidate":e(s.candidate);break}};function a(r){i=new RTCPeerConnection(w),i.setRemoteDescription(new RTCSessionDescription(r)),i.createAnswer().then(s=>{i.setLocalDescription(s),o.send(JSON.stringify({type:"answer",answer:s,room:n}))}),t()}function c(r){i.setRemoteDescription(new RTCSessionDescription(r))}function e(r){i.addIceCandidate(new RTCIceCandidate(r))}function t(){l=i.createDataChannel("fileTransfer"),l.onopen=()=>console.log("Data channel open"),l.onmessage=d}function d(r){const s=JSON.parse(r.data);g(_,new File([s.data],s.name))}p.addEventListener("change",r=>{Array.from(r.target.files).forEach(m=>{const u=new FileReader;u.onload=()=>{l.send(JSON.stringify({name:m.name,data:u.result}))},u.readAsArrayBuffer(m)})})}

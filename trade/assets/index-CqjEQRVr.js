(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const t of e.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&a(t)}).observe(document,{childList:!0,subtree:!0});function s(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?e.credentials="include":n.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(n){if(n.ep)return;n.ep=!0;const e=s(n);fetch(n.href,e)}})();const R="wss://relay.drobilica.com:8080",h="__TURN_SERVER_URL__",E="__TURN_USERNAME__",w="__TURN_CREDENTIAL__",C={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:h,username:E,credential:w}]},I=document.getElementById("generateRoomBtn"),m=document.getElementById("roomCode"),b=document.getElementById("copyRoomUrlBtn"),v=document.getElementById("copyRoomIdBtn"),S=document.getElementById("joinRoomInput"),B=document.getElementById("joinRoomBtn"),p=document.getElementById("yourFileInput"),L=document.getElementById("yourFiles"),N=document.getElementById("theirFiles"),_=document.getElementById("roomDisplay");let i,l,d;I.addEventListener("click",()=>{const o=Math.random().toString(36).substring(2,10);m.value=o,console.log(`Generated room: ${o}`),g(o)});b.addEventListener("click",()=>{const o=`${window.location.origin}/trade?room=${m.value}`;navigator.clipboard.writeText(o).then(()=>console.log("Room URL copied!")),console.log(`Copied room URL: ${o}`)});v.addEventListener("click",()=>{navigator.clipboard.writeText(m.value).then(()=>console.log("Room ID copied!")),console.log(`Copied room ID: ${m.value}`)});B.addEventListener("click",()=>{const o=S.value.trim();o&&g(o)});p.addEventListener("change",o=>{Array.from(o.target.files).forEach(s=>y(L,s))});function y(o,r){const s=document.createElement("li");s.textContent=r.name,s.className="border-b py-2";const a=document.createElement("button");a.textContent="Download",a.className="bg-blue-500 text-white px-2 py-1 rounded ml-2",a.addEventListener("click",()=>{const n=URL.createObjectURL(r),e=document.createElement("a");e.href=n,e.download=r.name,e.click()}),s.appendChild(a),o.appendChild(s),console.log(`Added file to list: ${r.name}`)}function g(o){console.log(`Joining room: ${o}`),_.textContent=`Joined Room: ${o}`,d=new WebSocket(R),d.onopen=()=>{d.send(JSON.stringify({type:"join",room:o})),console.log(`Connected to WebSocket and joined room: ${o}`)},d.onmessage=async e=>{const t=await e.data.text(),c=JSON.parse(t);switch(console.log(`Received message: ${JSON.stringify(c)}`),c.type){case"offer":r(c.offer);break;case"answer":s(c.answer);break;case"candidate":a(c.candidate);break}},d.onerror=e=>{console.error("WebSocket error:",e)};function r(e){i=new RTCPeerConnection(C),i.setRemoteDescription(new RTCSessionDescription(e)),i.createAnswer().then(t=>{i.setLocalDescription(t),d.send(JSON.stringify({type:"answer",answer:t,room:o})),console.log("Sent answer:",t)}),i.ondatachannel=t=>{l=t.channel,l.onopen=()=>console.log("Data channel open"),l.onmessage=n}}function s(e){i.setRemoteDescription(new RTCSessionDescription(e)),console.log("Received answer:",e)}function a(e){i.addIceCandidate(new RTCIceCandidate(e)),console.log("Received and added ICE candidate:",e)}p.addEventListener("change",e=>{Array.from(e.target.files).forEach(c=>{const u=new FileReader;u.onload=()=>{l&&l.readyState==="open"?(l.send(JSON.stringify({name:c.name,data:u.result})),console.log("Sent file:",c.name)):console.log("Data channel is not open")},u.readAsArrayBuffer(c)})});function n(e){const t=JSON.parse(e.data);console.log("Received file:",t.name);const c=new Blob([t.data]);y(N,new File([c],t.name))}}const U=new URLSearchParams(window.location.search),f=U.get("room");f&&g(f);

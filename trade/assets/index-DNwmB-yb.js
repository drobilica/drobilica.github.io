(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}})();var h={};const y=h.WEBSOCKET_SERVER_URL||"ws://localhost:8080";let s,c,d,r;const l=new WebSocket(y);l.onmessage=async o=>{const e=JSON.parse(o.data);if(e.type==="offer"){await c.setRemoteDescription(e.offer);const n=await c.createAnswer();await c.setLocalDescription(n),l.send(JSON.stringify({type:"answer",answer:n}))}else if(e.type==="answer")await s.setRemoteDescription(e.answer);else if(e.type==="candidate"){const n=new RTCIceCandidate(e.candidate);await s.addIceCandidate(n),await c.addIceCandidate(n)}};const C=document.getElementById("fileInput"),S=document.getElementById("receiveButton"),u=document.getElementById("qrCodeContainer"),w=document.getElementById("fileTradeBox"),v=document.getElementById("yourFilesList"),I=document.getElementById("partnerFilesList");C.addEventListener("change",B);S.addEventListener("click",R);function L(){return Math.random().toString(36).substring(2,11)}function R(){const e=`https://drobilica.com/shipit/${L()}`;u.innerHTML="",QRCode.toDataURL(e,{width:256,version:3},(n,i)=>{if(n){console.error("Error generating QR code:",n);return}const t=document.createElement("img");t.src=i,u.appendChild(t),E()})}function E(o){const e={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};s=new RTCPeerConnection(e),d=s.createDataChannel("sendDataChannel"),d.onopen=p,d.onclose=p,s.onicecandidate=n=>{n.candidate&&l.send(JSON.stringify({type:"candidate",candidate:n.candidate}))},c=new RTCPeerConnection(e),c.ondatachannel=O,c.onicecandidate=n=>{n.candidate&&l.send(JSON.stringify({type:"candidate",candidate:n.candidate}))},s.createOffer().then(n=>s.setLocalDescription(n)).then(()=>{l.send(JSON.stringify({type:"offer",offer:s.localDescription}))})}function p(o){if(d){const e=d.readyState;console.log(e==="open"?"Send channel is open":"Send channel is closed")}}function O(o){r=o.channel,r.onmessage=N,r.onopen=m,r.onclose=m}function m(o){if(r){const e=r.readyState;console.log(e==="open"?"Receive channel is open":"Receive channel is closed")}}function B(o){const e=o.target.files[0],n=new FileReader;n.onloadend=()=>{const i={name:e.name,data:n.result};localStorage.setItem("uploadedFile",JSON.stringify(i)),g(i,v),d.send(JSON.stringify(i))},e&&n.readAsDataURL(e)}function N(o){const e=JSON.parse(o.data);g(e,I)}function g(o,e){const n=document.createElement("li"),i=document.createElement("a");i.href=o.data,i.download=o.name,i.textContent=o.name,n.appendChild(i),e.appendChild(n),w.classList.remove("hidden")}

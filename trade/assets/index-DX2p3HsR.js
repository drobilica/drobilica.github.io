(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}})();const h="wss://relay.drobilica.com:8080";let c,s,d,r;const l=new WebSocket(h);l.onmessage=async o=>{const e=JSON.parse(o.data);if(e.type==="offer"){await s.setRemoteDescription(e.offer);const n=await s.createAnswer();await s.setLocalDescription(n),l.send(JSON.stringify({type:"answer",answer:n}))}else if(e.type==="answer")await c.setRemoteDescription(e.answer);else if(e.type==="candidate"){const n=new RTCIceCandidate(e.candidate);await c.addIceCandidate(n),await s.addIceCandidate(n)}};const y=document.getElementById("fileInput"),C=document.getElementById("receiveButton"),u=document.getElementById("qrCodeContainer"),w=document.getElementById("fileTradeBox"),S=document.getElementById("yourFilesList"),I=document.getElementById("partnerFilesList");y.addEventListener("change",E);C.addEventListener("click",L);function v(){return Math.random().toString(36).substring(2,11)}function L(){const e=`https://drobilica.com/shipit/${v()}`;u.innerHTML="",QRCode.toDataURL(e,{width:256,version:3},(n,i)=>{if(n){console.error("Error generating QR code:",n);return}const t=document.createElement("img");t.src=i,u.appendChild(t),O()})}function O(o){const e={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};c=new RTCPeerConnection(e),d=c.createDataChannel("sendDataChannel"),d.onopen=p,d.onclose=p,c.onicecandidate=n=>{n.candidate&&l.send(JSON.stringify({type:"candidate",candidate:n.candidate}))},s=new RTCPeerConnection(e),s.ondatachannel=R,s.onicecandidate=n=>{n.candidate&&l.send(JSON.stringify({type:"candidate",candidate:n.candidate}))},c.createOffer().then(n=>c.setLocalDescription(n)).then(()=>{l.send(JSON.stringify({type:"offer",offer:c.localDescription}))})}function p(o){if(d){const e=d.readyState;console.log(e==="open"?"Send channel is open":"Send channel is closed")}}function R(o){r=o.channel,r.onmessage=N,r.onopen=m,r.onclose=m}function m(o){if(r){const e=r.readyState;console.log(e==="open"?"Receive channel is open":"Receive channel is closed")}}function E(o){const e=o.target.files[0],n=new FileReader;n.onloadend=()=>{const i={name:e.name,data:n.result};localStorage.setItem("uploadedFile",JSON.stringify(i)),g(i,S),d.send(JSON.stringify(i))},e&&n.readAsDataURL(e)}function N(o){const e=JSON.parse(o.data);g(e,I)}function g(o,e){const n=document.createElement("li"),i=document.createElement("a");i.href=o.data,i.download=o.name,i.textContent=o.name,n.appendChild(i),e.appendChild(n),w.classList.remove("hidden")}

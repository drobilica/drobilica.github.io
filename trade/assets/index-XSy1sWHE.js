(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function c(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=c(e);fetch(e.href,n)}})();const y="wss://relay.drobilica.com:8080",R="__TURN_SERVER_URL__",h="__TURN_USERNAME__",E="__TURN_CREDENTIAL__",C={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:R,username:h,credential:E}]},w=document.getElementById("generateRoomBtn"),u=document.getElementById("roomCode"),v=document.getElementById("copyRoomUrlBtn"),I=document.getElementById("copyRoomIdBtn"),b=document.getElementById("joinRoomInput"),L=document.getElementById("joinRoomBtn"),g=document.getElementById("yourFileInput"),S=document.getElementById("yourFiles"),B=document.getElementById("theirFiles");let l,m;w.addEventListener("click",()=>{const o=Math.random().toString(36).substring(2,10);u.value=o,console.log(`Generated room: ${o}`)});v.addEventListener("click",()=>{const o=`${window.location.origin}/trade?room=${u.value}`;navigator.clipboard.writeText(o).then(()=>console.log("Room URL copied!")),console.log(`Copied room URL: ${o}`)});I.addEventListener("click",()=>{navigator.clipboard.writeText(u.value).then(()=>console.log("Room ID copied!")),console.log(`Copied room ID: ${u.value}`)});L.addEventListener("click",()=>{const o=b.value.trim();o&&N(o)});g.addEventListener("change",o=>{Array.from(o.target.files).forEach(c=>p(S,c))});function p(o,t){const c=document.createElement("li");c.textContent=t.name,c.className="border-b py-2";const i=document.createElement("button");i.textContent="Download",i.className="bg-blue-500 text-white px-2 py-1 rounded ml-2",i.addEventListener("click",()=>{const e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download=t.name,n.click()}),c.appendChild(i),o.appendChild(c),console.log(`Added file to list: ${t.name}`)}function N(o){console.log(`Joining room: ${o}`);const t=new WebSocket(y);t.onopen=()=>{t.send(JSON.stringify({type:"join",room:o})),console.log(`Connected to WebSocket and joined room: ${o}`)},t.onmessage=r=>{r.data.text().then(s=>{const a=JSON.parse(s);switch(console.log(`Received message: ${JSON.stringify(a)}`),a.type){case"offer":c(a.offer);break;case"answer":i(a.answer);break;case"candidate":e(a.candidate);break}})},t.onerror=r=>{console.error("WebSocket error:",r)};function c(r){l=new RTCPeerConnection(C),l.setRemoteDescription(new RTCSessionDescription(r)),l.createAnswer().then(s=>{l.setLocalDescription(s),t.send(JSON.stringify({type:"answer",answer:s,room:o})),console.log("Sent answer:",s)}),n()}function i(r){l.setRemoteDescription(new RTCSessionDescription(r)),console.log("Received answer:",r)}function e(r){l.addIceCandidate(new RTCIceCandidate(r)),console.log("Received and added ICE candidate:",r)}function n(){m=l.createDataChannel("fileTransfer"),m.onopen=()=>{console.log("Data channel open")},m.onmessage=d}function d(r){const s=JSON.parse(r.data);console.log("Received file:",s.name),p(B,new File([s.data],s.name))}g.addEventListener("change",r=>{Array.from(r.target.files).forEach(a=>{const f=new FileReader;f.onload=()=>{m.send(JSON.stringify({name:a.name,data:f.result})),console.log("Sent file:",a.name)},f.readAsArrayBuffer(a)})})}
